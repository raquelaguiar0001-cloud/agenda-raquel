<script>
    // ... (mantenha as configurações iniciais do Firebase e variáveis)

    function calculatePerformance() {
        // Filtra tarefas apenas do dia selecionado (ou de hoje, se nenhum selecionado)
        const dateToCalc = selDate || new Date().toISOString().split('T')[0];
        const dayTasks = tasks.filter(t => t.date === dateToCalc);
        
        const total = dayTasks.length;
        const done = dayTasks.filter(t => t.done).length;
        const pending = dayTasks.filter(t => !t.done);

        // Atualiza o display de progresso (ex: 7/10)
        const perfDoneElement = document.getElementById('perf-done');
        perfDoneElement.innerText = total > 0 ? `${done}/${total}` : "0/0";

        // Lógica de "Focar" ou "Atenção"
        const focusElement = document.getElementById('perf-focus');
        if (pending.length > 0) {
            // Descobre qual categoria tem mais tarefas pendentes
            const counts = pending.reduce((acc, t) => { 
                acc[t.label] = (acc[t.label] || 0) + 1; 
                return acc; 
            }, {});
            const topCategory = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
            // Mostra apenas o emoji/nome da categoria que precisa de atenção
            focusElement.innerText = topCategory.split(' ')[1] || topCategory;
            focusElement.style.color = "#ffdada"; 
        } else if (total > 0 && pending.length === 0) {
            focusElement.innerText = "✨";
            focusElement.style.color = "#55efc4";
        } else {
            focusElement.innerText = "---";
        }
    }

    // ... (mantenha o restante das funções como render, add, toggle)
</script>
